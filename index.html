```html
<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Apni Masjid — Masjid Management (Offline)</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <!-- third-party libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    /* =====================================================
       Visual / Islamic Theme CSS (Keep as in previous version)
       ===================================================== */

    :root{
      --bg1: #f6fbf9;
      --bg2: #eef7f2;
      --card: #ffffff;
      --accent: #5bb71e; /* deep green */
      --accent-2: #0368ff; /* blue */
      --muted: #0b84ed;
      --gold: #c59d48;
      --radius: 14px;
      --naskh: 'Amiri', serif;
      --ui: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:var(--ui);background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#0f1724;-webkit-font-smoothing:antialiased}
    .wrap{max-width:1200px;margin:18px auto;padding:18px;}
    header{display:flex;gap:12px;align-items:center;background:linear-gradient(90deg,#052a19, #074b3b);color:#fff;padding:18px;border-radius:12px;box-shadow:0 10px 30px rgba(2,18,10,0.12)}
    header img.logo{width:82px;height:82px;object-fit:cover;border-radius:12px;border:3px solid rgba(255,255,255,0.08)}
    header .title{font-family:var(--naskh);font-size:22px;font-weight:700}
    header .subtitle{font-size:13px;opacity:0.9}
    .toolbar{margin-left:auto;display:flex;gap:8px;align-items:center}
    button{background:var(--accent);color:#76fd00;padding:10px 12px;border:0;border-radius:10px;cursor:pointer;font-weight:600}
    button.ghost{background:transparent;border:1px solid rgba(0,0,0,0.06);color:var(--accent)}
    button.warn{background:#f70800}
    .card{background:var(--card);border-radius:var(--radius);padding:14px;margin-top:14px;box-shadow:0 6px 20px rgba(12,38,63,0.06)}
    h3{margin:0 0 8px 0;font-family:var(--naskh)}
    .grid{display:grid;gap:12px}
    .cols-3{grid-template-columns:1fr 1fr 1fr}
    .cols-2{grid-template-columns:1fr 1fr}
    .flex{display:flex;gap:10px;align-items:center}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input[type="text"],input[type="number"],input[type="date"],select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid #e6eef0;background:transparent;font-size:14px}
    textarea{min-height:80px;resize:vertical}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:8px;border-bottom:1px solid #d51111;text-align:left;font-size:14px}
    th{background:linear-gradient(90deg,#03fd91,#7700ff33);color:#fff;border-radius:6px}
    .muted{color:var(--muted)}
    .center{text-align:center}
    .right{text-align:right}
    .img-preview{width:120px;height:80px;object-fit:cover;border-radius:8px;border:1px solid #eee}
    .pill{display:inline-block;padding:6px 10px;background:#00ed00;color:var(--accent);border-radius:999px;font-weight:700}
    .search{display:flex;gap:8px;align-items:center}
    .search input{width:100%;padding:8px;border-radius:999px;border:1px solid #e6eef0}
    .small-btn{padding:6px 8px;border-radius:8px;border:0;background:#e9f6f0;color:var(--accent);cursor:pointer}
    .badge{padding:4px 8px;border-radius:999px;background:#fff6e6;color:var(--gold);font-weight:700;border:1px solid rgba(197,157,72,0.15)}
    .watermark{
      background-image: radial-gradient(circle at 10% 10%, rgba(11,94,215,0.03), transparent 20%),
                        radial-gradient(circle at 90% 90%, rgba(11,93,58,0.03), transparent 20%);
      padding:18px;border-radius:12px;
    }
    footer{margin-top:18px;color:#4b5563;font-size:13px;text-align:center}
    @media (max-width:980px){
      .cols-3,.cols-2{grid-template-columns:1fr}
      header{flex-direction:column;align-items:flex-start;gap:8px}
      .toolbar{margin-left:0}
    }

    /* Additional decorative styles for future PDF / architecture visuals (placeholders) */
    .islamic-pattern {
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="400"><defs><pattern id="p" width="40" height="40" patternUnits="userSpaceOnUse"><rect width="40" height="40" fill="%23f6fbf9"/><path d="M20 0 L40 20 L20 40 L0 20 Z" fill="%230b5d3a33"/></pattern></defs><rect width="100%" height="100%" fill="url(%23p)"/></svg>');
      background-size: 200px;
      border-radius: 12px;
    }

    /* helper */
    .hidden { display:none; }

  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img id="mosque-logo" class="logo" src="" alt="Masjid Logo" onerror="this.style.display='none'"/>
      <div>
        <div class="title" id="mosque-title">Apni Masjid — Management</div>
        <div class="subtitle muted" id="mosque-sub">Offline Islamic masjid management app — donations, jumma, construction budget, reports</div>
      </div>

      <div class="toolbar">
        <button id="export-all">Export Summary PDF</button>
        <button id="export-notice" class="ghost">Create Islamic Notice</button>
        <button id="generate-qr" class="ghost"><i class="fa fa-qrcode"></i> QR</button>
      </div>
    </header>

    <!-- Masjid Info -->
    <section class="card" id="mosque-info-card">
      <h3>Masjid Info</h3>
      <div class="grid cols-3">
        <div>
          <label>Masjid ka Naam</label>
          <input type="text" id="mosque-name" placeholder="Masjid ka naam likhen" />
        </div>
        <div>
          <label>Address (optional)</label>
          <input type="text" id="mosque-address" placeholder="Address likhen" />
        </div>
        <div>
          <label>Logo / Photo</label>
          <input type="file" id="logo-file" accept="image/*" />
          <div class="mt8"><img id="logo-preview" class="img-preview" src="" alt="Preview" style="display:none"/></div>
        </div>
      </div>
      <div class="mt8">
        <button id="save-mosque">Save Masjid Info</button>
        <button id="reset-data" class="ghost">Reset All Data</button>
      </div>
    </section>

    <!-- Committee Members & Households -->
    <section class="card">
      <h3>Committee Members & Households</h3>
      <div class="grid cols-2">
        <div>
          <label>Committee Member ka Naam</label>
          <input type="text" id="member-name" placeholder="e.g., Haji Umar" />
          <label class="mt8">Member Phone / Note (optional)</label>
          <input type="text" id="member-note" placeholder="Phone ya note" />
          <div class="mt8">
            <button id="add-member">Add Committee Member</button>
          </div>
        </div>

        <div>
          <label>Add Household to Selected Member</label>
          <select id="select-member-to-add-household"><option value="">-- Select Member --</option></select>
          <label class="mt8">Household Name / Head</label>
          <input type="text" id="household-name" placeholder="e.g., Ghar No 1 - Ali" />
          <label class="mt8">Household Note (Address / Family Count)</label>
          <input type="text" id="household-note" placeholder="e.g., 6 log, address" />
          <div class="mt8">
            <button id="add-household">Add Household</button>
          </div>
        </div>
      </div>

      <div class="mt8">
        <div class="search">
          <input type="text" id="search-members" placeholder="Search members or households..." />
          <div class="pill">Search</div>
        </div>
      </div>

      <div class="mt8 table-scroll card" style="padding:8px;">
        <table id="members-table">
          <thead><tr><th>Member</th><th>Households</th><th>Note</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Donations -->
    <section class="card">
      <h3>Donations / Chanda (Monthly) & Cemetery & Jumma</h3>

      <div class="grid cols-3">
        <div>
          <label>Donation Date</label>
          <input type="date" id="donation-date" value="" />
          <label class="mt8">Amount (₹)</label>
          <input type="text" id="donation-amount" placeholder="e.g., 500 or 'Five Hundred' (alphabets allowed)" />
        </div>

        <div>
          <label>Donation Type</label>
          <select id="donation-type">
            <option value="monthly">Monthly Chanda</option>
            <option value="cemetery">Qabristan / Cemetery</option>
            <option value="jumma">Jumma Collection</option>
            <option value="other">Other</option>
          </select>

          <label class="mt8">From (Member or Household)</label>
          <select id="donation-from">
            <option value="">-- Select Member / Household --</option>
          </select>
        </div>

        <div>
          <label>Note (optional)</label>
          <input type="text" id="donation-note" placeholder="e.g., Ramadan chanda" />
          <div style="margin-top:8px">
            <button id="add-donation">Add Donation</button>
          </div>
        </div>
      </div>

      <div style="margin-top:12px" class="flex">
        <div class="search" style="flex:1">
          <input type="text" id="search-donations" placeholder="Search donations by donor, type, note..." />
          <div class="pill">Search</div>
        </div>
        <div style="margin-left:auto" class="flex">
          <button id="export-csv" class="ghost">Export CSV</button>
        </div>
      </div>

      <div class="mt8 table-scroll card" style="padding:8px;">
        <table id="donations-table">
          <thead><tr><th>Date</th><th>Type</th><th>From</th><th>Amount</th><th>Note</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Jumma Collections & Expenses -->
    <section class="card">
      <h3>Jumma Collection & Uska Kharch</h3>
      <div class="grid cols-3">
        <div>
          <label>Jumma Date</label>
          <input type="date" id="jumma-date" value="" />
          <label class="mt8">Amount Collected (₹)</label>
          <input type="text" id="jumma-amount" placeholder="e.g., 2000 or 'Two Thousand'" />
        </div>

        <div>
          <label>Collected By (Member/Volunteer)</label>
          <select id="jumma-collected-by">
            <option value="">-- Select --</option>
          </select>

          <label class="mt8">Note (optional)</label>
          <input type="text" id="jumma-note" placeholder="e.g., special khutbah collection" />
        </div>

        <div>
          <label>Kharch (Expense) for Jumma</label>
          <input type="text" id="jumma-expense-amount" placeholder="Expense amount or text" />
          <label class="mt8">Expense Note</label>
          <input type="text" id="jumma-expense-note" placeholder="e.g., tea, cleaning" />
        </div>
      </div>

      <div style="margin-top:10px" class="flex">
        <button id="add-jumma">Add Jumma Collection</button>
        <button id="export-jumma-ledger" class="ghost">Export Jumma Ledger PDF</button>
        <div style="margin-left:auto" class="muted">Jumma ke liye alag ledger maintain hota hai</div>
      </div>

      <div style="margin-top:12px" class="search">
        <input type="text" id="search-jumma" placeholder="Search jumma by date, note, collector..." />
        <div class="pill">Search</div>
      </div>

      <div class="mt8 table-scroll card" style="padding:8px;">
        <table id="jumma-table">
          <thead><tr><th>Date</th><th>Collected By</th><th>Collected</th><th>Expense</th><th>Net</th><th>Note</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Construction Budget -->
    <section class="card">
      <h3>Masjid Construction Budget / Fundraising</h3>

      <div class="grid cols-3">
        <div>
          <label>Contribution Date</label>
          <input type="date" id="construction-date" />
          <label class="mt8">Contributor Name</label>
          <input type="text" id="construction-contributor" placeholder="Kaun jama kar raha hai" />
          <label class="mt8">Amount (₹ or text)</label>
          <input type="text" id="construction-amount" placeholder="e.g., 10000 or 'Ten Thousand'" />
        </div>

        <div>
          <label>Contributor Contact (optional)</label>
          <input type="text" id="construction-contact" placeholder="Phone / note" />
          <label class="mt8">Contribution Type</label>
          <select id="construction-type">
            <option value="donation">Donation</option>
            <option value="loan">Loan</option>
            <option value="materials">Materials</option>
          </select>
          <div style="margin-top:8px">
            <button id="add-contribution">Add Contribution</button>
          </div>
        </div>

        <div>
          <label>Construction Expense Date</label>
          <input type="date" id="construction-expense-date" />
          <label class="mt8">Expense For</label>
          <input type="text" id="construction-expense-for" placeholder="e.g., bricks, labour" />
          <label class="mt8">Expense Amount (₹ or text)</label>
          <input type="text" id="construction-expense-amount" />
          <div style="margin-top:8px">
            <button id="add-construction-expense" class="ghost">Add Expense</button>
          </div>
        </div>
      </div>

      <div style="margin-top:12px" class="search">
        <input type="text" id="search-construction" placeholder="Search contributors or expenses..." />
        <div class="pill">Search</div>
      </div>

      <div style="margin-top:10px" class="grid cols-2">
        <div class="card">
          <h4>Contributors</h4>
          <table id="construction-contributors-table"><thead><tr><th>Date</th><th>Name</th><th>Amount</th><th>Contact</th><th>Type</th><th>Actions</th></tr></thead><tbody></tbody></table>
        </div>
        <div class="card">
          <h4>Expenses</h4>
          <table id="construction-expenses-table"><thead><tr><th>Date</th><th>For</th><th>Amount</th><th>Note</th><th>Actions</th></tr></thead><tbody></tbody></table>
        </div>
      </div>

      <div style="margin-top:12px" class="flex">
        <div><strong>Total Raised:</strong> <span id="construction-total-raised">₹ 0</span></div>
        <div style="margin-left:12px"><strong>Total Spent:</strong> <span id="construction-total-spent">₹ 0</span></div>
        <div style="margin-left:12px"><strong>Balance:</strong> <span id="construction-balance">₹ 0</span></div>
        <div style="margin-left:auto"><button id="export-construction-report" class="ghost">Export Construction Report</button></div>
      </div>
    </section>

    <!-- Summary & Ledger -->
    <section class="card watermark">
      <h3>Summary & Reports</h3>
      <div class="grid cols-3">
        <div class="center">
          <div class="muted">Total Collected</div>
          <div class="pill" id="total-collected">₹ 0</div>
        </div>
        <div class="center">
          <div class="muted">Total Jumma Net</div>
          <div class="pill" id="total-jumma">₹ 0</div>
        </div>
        <div class="center">
          <div class="muted">Construction Balance</div>
          <div class="pill" id="construction-summary">₹ 0</div>
        </div>
      </div>

      <div style="margin-top:12px">
        <label>Select Member to view ledger</label>
        <select id="ledger-member"><option value="">-- All / Select Member --</option></select>
        <div style="margin-top:8px" class="table-scroll card">
          <table id="ledger-table">
            <thead><tr><th>Date</th><th>Type</th><th>Amount</th><th>Note</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div style="margin-top:8px" class="flex">
          <button id="export-ledger" class="ghost">Export Ledger PDF</button>
        </div>
      </div>
    </section>

    <footer class="muted card center">
      Ye offline masjid management app hai. Data browser ke LocalStorage me save hota hai. Kisi bhi problem me mujhe batao.
    </footer>
  </div>

  <script>
    /* ===========================================================
       Full App JS: Storage, UI wiring, renderers, exports, search
       (This script keeps all features exactly as in previous version.
        New requested additions (delete/edit options, alphabets for amounts,
        dedicated PDF for rupee-text fields, more beautiful Islamic architecture
        visuals in PDFs, bismillah at start) are integrated below without
        altering existing behaviors.)
       =========================================================== */

    /* ----------------------
       Storage keys & defaults
       ---------------------- */
    const STORAGE_KEY = 'masjid_mgmt_v2';
    const defaultState = {
      mosque: { id: genId(), name: 'Apni Masjid', address: '', logo: '' },
      members: [], // {id,name,note,households: [{id,name,note}]}
      donations: [], // {id,date,type,amountRaw,amountDisplay,fromId,fromName,note}
      jumma: [], // {id,date,collectorId,collectorName,amountRaw,amountDisplay,expenseRaw,expenseDisplay,expenseNote,note}
      construction: { contributions: [], expenses: [] } // contributions: {id,date,name,amountRaw,amountDisplay,contact,type}, expenses: {id,date,for,amountRaw,amountDisplay,note}
    };

    // utility id
    function genId(){ return 'id_' + Date.now().toString(36) + Math.random().toString(36).slice(2,7); }

    // load or init
    let state = loadState();

    // DOM refs (kept same as previous)
    const mosqueTitleEl = document.getElementById('mosque-title');
    const mosqueSubEl = document.getElementById('mosque-sub');
    const mosqueLogoEl = document.getElementById('mosque-logo');
    const mosqueNameInput = document.getElementById('mosque-name');
    const mosqueAddressInput = document.getElementById('mosque-address');
    const logoFileInput = document.getElementById('logo-file');
    const logoPreview = document.getElementById('logo-preview');
    const saveMosqueBtn = document.getElementById('save-mosque');
    const resetDataBtn = document.getElementById('reset-data');

    const memberNameInput = document.getElementById('member-name');
    const memberNoteInput = document.getElementById('member-note');
    const addMemberBtn = document.getElementById('add-member');
    const membersTableBody = document.querySelector('#members-table tbody');
    const selectMemberToAddHousehold = document.getElementById('select-member-to-add-household');
    const householdNameInput = document.getElementById('household-name');
    const householdNoteInput = document.getElementById('household-note');
    const addHouseholdBtn = document.getElementById('add-household');
    const searchMembersInput = document.getElementById('search-members');

    const donationDateInput = document.getElementById('donation-date');
    const donationAmountInput = document.getElementById('donation-amount');
    const donationTypeSel = document.getElementById('donation-type');
    const donationFromSel = document.getElementById('donation-from');
    const donationNoteInput = document.getElementById('donation-note');
    const addDonationBtn = document.getElementById('add-donation');
    const donationsTableBody = document.querySelector('#donations-table tbody');
    const searchDonationsInput = document.getElementById('search-donations');
    const exportCsvBtn = document.getElementById('export-csv');

    const jummaDateInput = document.getElementById('jumma-date');
    const jummaAmountInput = document.getElementById('jumma-amount');
    const jummaCollectedBySel = document.getElementById('jumma-collected-by');
    const jummaNoteInput = document.getElementById('jumma-note');
    const jummaExpenseAmountInput = document.getElementById('jumma-expense-amount');
    const jummaExpenseNoteInput = document.getElementById('jumma-expense-note');
    const addJummaBtn = document.getElementById('add-jumma');
    const jummaTableBody = document.querySelector('#jumma-table tbody');
    const searchJummaInput = document.getElementById('search-jumma');
    const exportJummaBtn = document.getElementById('export-jumma-ledger');

    const constructionDateInput = document.getElementById('construction-date');
    const constructionContributorInput = document.getElementById('construction-contributor');
    const constructionAmountInput = document.getElementById('construction-amount');
    const constructionContactInput = document.getElementById('construction-contact');
    const constructionTypeSel = document.getElementById('construction-type');
    const addContributionBtn = document.getElementById('add-contribution');

    const constructionExpenseDateInput = document.getElementById('construction-expense-date');
    const constructionExpenseForInput = document.getElementById('construction-expense-for');
    const constructionExpenseAmountInput = document.getElementById('construction-expense-amount');
    const addConstructionExpenseBtn = document.getElementById('add-construction-expense');

    const contributorsTableBody = document.querySelector('#construction-contributors-table tbody');
    const expensesTableBody = document.querySelector('#construction-expenses-table tbody');
    const searchConstructionInput = document.getElementById('search-construction');
    const constructionTotalRaisedEl = document.getElementById('construction-total-raised');
    const constructionTotalSpentEl = document.getElementById('construction-total-spent');
    const constructionBalanceEl = document.getElementById('construction-balance');
    const exportConstructionBtn = document.getElementById('export-construction-report');

    const totalCollectedEl = document.getElementById('total-collected');
    const totalJummaEl = document.getElementById('total-jumma');
    const constructionSummaryEl = document.getElementById('construction-summary');
    const ledgerMemberSel = document.getElementById('ledger-member');
    const ledgerTableBody = document.querySelector('#ledger-table tbody');
    const exportLedgerBtn = document.getElementById('export-ledger');

    const exportAllBtn = document.getElementById('export-all');
    const exportNoticeBtn = document.getElementById('export-notice');
    const qrButton = document.getElementById('generate-qr');

    // initial setup
    (function init(){
      donationDateInput.value = new Date().toISOString().slice(0,10);
      jummaDateInput.value = new Date().toISOString().slice(0,10);
      constructionDateInput.value = new Date().toISOString().slice(0,10);
      constructionExpenseDateInput.value = new Date().toISOString().slice(0,10);
      populateYearFilters();
      renderAllUI();
      wireEvents();
    })();

    // -----------------------
    // Storage helpers
    // -----------------------
    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return JSON.parse(JSON.stringify(defaultState));
        const parsed = JSON.parse(raw);

        // Migration: if old donations used 'amount' field, convert to amountRaw/amountDisplay
        if(parsed && parsed.donations){
          parsed.donations = parsed.donations.map(d=>{
            if(d.amountRaw === undefined && d.amount !== undefined){
              return {...d, amountRaw: d.amount, amountDisplay: String(d.amount)};
            }
            return d;
          });
        }
        return parsed;
      }catch(e){
        console.error('loadState error', e);
        return JSON.parse(JSON.stringify(defaultState));
      }
    }
    function saveState(){
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      }catch(e){
        console.error('saveState error', e);
      }
    }
    function resetState(){
      if(!confirm('Kya aap sab data reset karna chahte hain? Ye action wapas nahi hoga.')) return;
      state = JSON.parse(JSON.stringify(defaultState));
      saveState();
      location.reload();
    }

    // -----------------------
    // Event wiring
    // -----------------------
    function wireEvents(){
      logoFileInput.addEventListener('change', handleLogoUpload);
      saveMosqueBtn.addEventListener('click', saveMosqueInfo);
      resetDataBtn.addEventListener('click', resetState);

      addMemberBtn.addEventListener('click', handleAddMember);
      addHouseholdBtn.addEventListener('click', handleAddHousehold);
      searchMembersInput.addEventListener('input', renderMembersTable);

      addDonationBtn.addEventListener('click', handleAddDonation);
      searchDonationsInput.addEventListener('input', renderDonationsTable);
      exportCsvBtn.addEventListener('click', exportAllCSV);

      addJummaBtn.addEventListener('click', handleAddJumma);
      searchJummaInput.addEventListener('input', renderJummaTable);
      exportJummaBtn.addEventListener('click', exportJummaPDF);

      addContributionBtn.addEventListener('click', handleAddContribution);
      addConstructionExpenseBtn.addEventListener('click', handleAddConstructionExpense);
      searchConstructionInput.addEventListener('input', renderConstructionTables);
      exportConstructionBtn.addEventListener('click', exportConstructionReport);

      ledgerMemberSel.addEventListener('change', renderLedgerForMember);
      exportLedgerBtn.addEventListener('click', exportLedgerPDF);

      exportAllBtn.addEventListener('click', exportSummaryPDF);
      exportNoticeBtn.addEventListener('click', createIslamicNoticePDF);
      qrButton.addEventListener('click', openQRCodeDialog);

      window.addEventListener('beforeunload', ()=> saveState());
    }

    // -----------------------
    // Mosque info handlers
    // -----------------------
    function handleLogoUpload(e){
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        state.mosque.logo = reader.result;
        logoPreview.src = reader.result;
        logoPreview.style.display = 'inline-block';
        mosqueLogoEl.src = reader.result;
        mosqueLogoEl.style.display = 'inline-block';
        saveState();
      };
      reader.readAsDataURL(file);
    }

    function saveMosqueInfo(){
      const name = mosqueNameInput.value.trim() || state.mosque.name || 'Apni Masjid';
      const address = mosqueAddressInput.value.trim() || '';
      state.mosque.name = name;
      state.mosque.address = address;
      mosqueTitleEl.textContent = name + ' — Management';
      mosqueSubEl.textContent = address;
      saveState();
      alert('Masjid info saved.');
      renderAllUI();
    }

    // -----------------------
    // Members & households
    // -----------------------
    function handleAddMember(){
      const name = memberNameInput.value.trim();
      const note = memberNoteInput.value.trim();
      if(!name) { alert('Member ka naam likhen'); return; }
      const member = { id: genId(), name, note, households: [] };
      state.members.push(member);
      saveState();
      memberNameInput.value = '';
      memberNoteInput.value = '';
      renderAllUI();
    }

    function handleAddHousehold(){
      const memberId = selectMemberToAddHousehold.value;
      if(!memberId) { alert('Pehle member select karo'); return; }
      const hname = householdNameInput.value.trim();
      if(!hname) { alert('Household name likhen'); return; }
      const hnote = householdNoteInput.value.trim();
      const member = state.members.find(m=>m.id === memberId);
      if(!member) { alert('Member nahi mila'); return; }
      member.households.push({ id: genId(), name: hname, note: hnote });
      saveState();
      householdNameInput.value = '';
      householdNoteInput.value = '';
      renderAllUI();
    }

    function deleteMember(memberId){
      if(!confirm('Member delete karne par uske households aur donations bhi delete ho sakte hain. Continue?')) return;
      const member = state.members.find(m=>m.id === memberId);
      const memberHouseIds = (member && member.households) ? member.households.map(h=>h.id) : [];
      // remove donations linked
      state.donations = state.donations.filter(d => !(d.fromId === memberId || memberHouseIds.includes(d.fromId)));
      // remove jumma collected by this member? we'll keep jumma records but collector id cleared
      state.jumma = state.jumma.map(j => j.collectorId === memberId ? {...j, collectorId:'', collectorName:'(deleted)'} : j);
      // remove member
      state.members = state.members.filter(m=>m.id !== memberId);
      saveState();
      renderAllUI();
    }

    function deleteHousehold(memberId, householdId){
      if(!confirm('Household delete karna hai? Donations linked delete ho sakte hain.')) return;
      state.donations = state.donations.filter(d=>d.fromId !== householdId);
      const member = state.members.find(m=>m.id === memberId);
      if(!member) return;
      member.households = member.households.filter(h=>h.id !== householdId);
      saveState();
      renderAllUI();
    }

    // Exposed handlers for inline onclick (safe enough)
    window.deleteMemberHandler = function(id){ deleteMember(id); };
    window.editMemberHandler = function(id){
      const member = state.members.find(m=>m.id===id);
      if(!member) return;
      const newName = prompt('Member ka naya naam', member.name);
      if(newName===null) return;
      member.name = newName.trim() || member.name;
      const newNote = prompt('Member note', member.note||'');
      if(newNote!==null) member.note = newNote.trim();
      saveState(); renderAllUI();
    };
    window.deleteHouseholdHandler = function(memberId, householdId){ deleteHousehold(memberId, householdId); };

    // -----------------------
    // Donations handlers (supports text amounts and numeric amounts)
    // -----------------------
    function parseAmountInput(raw){
      // raw may be number-like string or alphabets like "Five Hundred"
      if(raw === undefined || raw === null) return { raw: '', display: '' };
      const s = String(raw).trim();
      // try numeric parse first
      const num = Number(s.replace(/,/g,''));
      if(!isNaN(num) && s.match(/[0-9]/)){
        return { raw: num, display: s };
      }
      // otherwise treat as textual amount; store raw as text and display same
      return { raw: s, display: s };
    }

    function handleAddDonation(){
      const date = donationDateInput.value || new Date().toISOString().slice(0,10);
      const amountInput = donationAmountInput.value || '';
      const parsed = parseAmountInput(amountInput);
      const type = donationTypeSel.value;
      const fromId = donationFromSel.value || '';
      const fromName = donationFromSel.options[donationFromSel.selectedIndex]?.text || '';
      const note = donationNoteInput.value.trim();

      if((parsed.raw === '' || parsed.raw === 0) && String(parsed.display).trim() === '') { alert('Sahi amount daalo'); return; }

      const donation = { id: genId(), date, type, amountRaw: parsed.raw, amountDisplay: parsed.display, fromId, fromName, note };
      state.donations.push(donation);
      saveState();
      donationAmountInput.value = '';
      donationNoteInput.value = '';
      renderAllUI();
    }

    function deleteDonation(id){
      if(!confirm('Donation record delete karna hai?')) return;
      state.donations = state.donations.filter(d=>d.id !== id);
      saveState();
      renderAllUI();
    }

    function editDonation(id){
      const d = state.donations.find(x=>x.id===id);
      if(!d) return;
      const newDate = prompt('New date', d.date) || d.date;
      const newAmount = prompt('Amount (you can write alphabets too)', d.amountDisplay) || d.amountDisplay;
      const newNote = prompt('Note', d.note || '') || d.note;
      d.date = newDate;
      const parsed = parseAmountInput(newAmount);
      d.amountRaw = parsed.raw;
      d.amountDisplay = parsed.display;
      d.note = newNote;
      saveState();
      renderAllUI();
    }

    // -----------------------
    // Jumma handlers (supports text amounts)
    // -----------------------
    function handleAddJumma(){
      const date = jummaDateInput.value || new Date().toISOString().slice(0,10);
      const amountInput = jummaAmountInput.value || '';
      const parsed = parseAmountInput(amountInput);
      const collectorId = jummaCollectedBySel.value || '';
      const collectorName = jummaCollectedBySel.options[jummaCollectedBySel.selectedIndex]?.text || '';
      const expenseInput = jummaExpenseAmountInput.value || '';
      const expenseParsed = parseAmountInput(expenseInput);
      const expenseNote = jummaExpenseNoteInput.value.trim();
      const note = jummaNoteInput.value.trim();

      if((parsed.raw === '' || parsed.raw === 0) && String(parsed.display).trim() === ''){ alert('Jumma ke liye sahi amount daalo'); return; }

      const j = { id: genId(), date, collectorId, collectorName, amountRaw: parsed.raw, amountDisplay: parsed.display, expenseRaw: expenseParsed.raw, expenseDisplay: expenseParsed.display, expenseNote, note };
      state.jumma.push(j);
      saveState();

      // also add to donations as type jumma (for overall totals) - preserve textual amount
      const donationRecord = { id: genId(), date, type: 'jumma', amountRaw: parsed.raw, amountDisplay: parsed.display, fromId: collectorId, fromName: collectorName, note: note || ('Jumma collection: ' + (collectorName || '')) };
      state.donations.push(donationRecord);
      saveState();

      jummaAmountInput.value = '';
      jummaExpenseAmountInput.value = '';
      jummaNoteInput.value = '';
      jummaExpenseNoteInput.value = '';
      renderAllUI();
    }

    function deleteJumma(id){
      if(!confirm('Jumma record delete karna hai?')) return;
      state.jumma = state.jumma.filter(j=>j.id !== id);
      // remove corresponding donations with matching id? we stored separately; remove donations that were added with same date+amountDisplay and type jumma (best-effort)
      state.donations = state.donations.filter(d => !(d.type==='jumma' && state.jumma.every(j => !(j.date===d.date && j.amountDisplay===d.amountDisplay))));
      saveState();
      renderAllUI();
    }

    function editJumma(id){
      const j = state.jumma.find(x=>x.id===id);
      if(!j) return;
      const newDate = prompt('New date', j.date) || j.date;
      const newAmount = prompt('Amount (you can write alphabets too)', j.amountDisplay) || j.amountDisplay;
      const newExpense = prompt('Expense amount (text allowed)', j.expenseDisplay || '') || j.expenseDisplay || '';
      const newNote = prompt('Note', j.note || '') || j.note;
      j.date = newDate;
      const parsed = parseAmountInput(newAmount);
      j.amountRaw = parsed.raw; j.amountDisplay = parsed.display;
      const eparsed = parseAmountInput(newExpense);
      j.expenseRaw = eparsed.raw; j.expenseDisplay = eparsed.display;
      j.note = newNote;
      saveState();
      renderAllUI();
    }

    // -----------------------
    // Construction handlers (supports text amounts)
    // -----------------------
    function handleAddContribution(){
      const date = constructionDateInput.value || new Date().toISOString().slice(0,10);
      const name = constructionContributorInput.value.trim();
      const amountInput = constructionAmountInput.value || '';
      const parsed = parseAmountInput(amountInput);
      const contact = constructionContactInput.value.trim();
      const type = constructionTypeSel.value || 'donation';
      if(!name || (parsed.raw === '' && String(parsed.display).trim() === '')){ alert('Contributor name aur sahi amount do'); return; }
      const c = { id: genId(), date, name, amountRaw: parsed.raw, amountDisplay: parsed.display, contact, type };
      state.construction.contributions.push(c);
      saveState();
      constructionContributorInput.value = '';
      constructionAmountInput.value = '';
      constructionContactInput.value = '';
      renderAllUI();
    }

    function handleAddConstructionExpense(){
      const date = constructionExpenseDateInput.value || new Date().toISOString().slice(0,10);
      const forWhat = constructionExpenseForInput.value.trim();
      const amountInput = constructionExpenseAmountInput.value || '';
      const parsed = parseAmountInput(amountInput);
      if(!forWhat || (parsed.raw === '' && String(parsed.display).trim() === '')){ alert('Expense reason aur amount do'); return; }
      const e = { id: genId(), date, for: forWhat, amountRaw: parsed.raw, amountDisplay: parsed.display, note: '' };
      state.construction.expenses.push(e);
      saveState();
      constructionExpenseForInput.value = '';
      constructionExpenseAmountInput.value = '';
      renderAllUI();
    }

    function deleteContribution(id){
      if(!confirm('Contribution delete karna hai?')) return;
      state.construction.contributions = state.construction.contributions.filter(c=>c.id !== id);
      saveState();
      renderAllUI();
    }

    function deleteConstructionExpense(id){
      if(!confirm('Expense delete karna hai?')) return;
      state.construction.expenses = state.construction.expenses.filter(e=>e.id !== id);
      saveState();
      renderAllUI();
    }

    function editContribution(id){
      const c = state.construction.contributions.find(x=>x.id===id);
      if(!c) return;
      const newDate = prompt('Date', c.date) || c.date;
      const newName = prompt('Contributor Name', c.name) || c.name;
      const newAmount = prompt('Amount (text allowed)', c.amountDisplay) || c.amountDisplay;
      const newContact = prompt('Contact', c.contact || '') || c.contact;
      c.date = newDate; c.name = newName;
      const parsed = parseAmountInput(newAmount);
      c.amountRaw = parsed.raw; c.amountDisplay = parsed.display;
      c.contact = newContact;
      saveState(); renderAllUI();
    }

    function editConstructionExpense(id){
      const e = state.construction.expenses.find(x=>x.id===id);
      if(!e) return;
      const newDate = prompt('Date', e.date) || e.date;
      const newFor = prompt('Expense for', e.for) || e.for;
      const newAmount = prompt('Amount (text allowed)', e.amountDisplay) || e.amountDisplay;
      const newNote = prompt('Note', e.note || '') || e.note;
      e.date = newDate; e.for = newFor; e.note = newNote;
      const parsed = parseAmountInput(newAmount);
      e.amountRaw = parsed.raw; e.amountDisplay = parsed.display;
      saveState(); renderAllUI();
    }

    // -----------------------
    // Renderers
    // -----------------------
    function renderAllUI(){
      // mosque info
      mosqueTitleEl.textContent = state.mosque.name + ' — Management';
      mosqueSubEl.textContent = state.mosque.address || '';
      mosqueNameInput.value = state.mosque.name || '';
      mosqueAddressInput.value = state.mosque.address || '';
      if(state.mosque.logo){
        mosqueLogoEl.src = state.mosque.logo;
        mosqueLogoEl.style.display = 'inline-block';
        logoPreview.src = state.mosque.logo;
        logoPreview.style.display = 'inline-block';
      } else {
        mosqueLogoEl.style.display = 'none';
        logoPreview.style.display = 'none';
      }

      renderMembersTable();
      populateDonationFromOptions();
      renderDonationsTable();
      renderSummary();
      populateLedgerMembers();
      renderLedgerForMember();
      renderJummaTable();
      renderConstructionTables();
    }

    function renderMembersTable(){
      membersTableBody.innerHTML = '';
      // populate select for adding households & jumma collector
      selectMemberToAddHousehold.innerHTML = '<option value="">-- Select Member --</option>';
      jummaCollectedBySel.innerHTML = '<option value="">-- Select --</option>';

      const q = (searchMembersInput.value || '').toLowerCase().trim();

      state.members.forEach(member=>{
        // add to dropdowns
        const opt = document.createElement('option');
        opt.value = member.id; opt.text = member.name + ' (Member)';
        selectMemberToAddHousehold.appendChild(opt);

        const opt2 = document.createElement('option');
        opt2.value = member.id; opt2.text = member.name;
        jummaCollectedBySel.appendChild(opt2);

        // build table row
        const tr = document.createElement('tr');
        const tdName = document.createElement('td');
        tdName.innerHTML = `<strong>${escapeHtml(member.name)}</strong>`;
        tr.appendChild(tdName);

        const tdHouse = document.createElement('td');
        if(member.households && member.households.length){
          const ul = document.createElement('div');
          ul.innerHTML = member.households.map(h => `<div style="margin-bottom:6px"><b>${escapeHtml(h.name)}</b> <span class="muted">(${escapeHtml(h.note)})</span> <button class="small-btn" onclick="window.deleteHouseholdHandler('${member.id}','${h.id}')">Delete</button></div>`).join('');
          tdHouse.appendChild(ul);
        } else { tdHouse.textContent = '—'; }
        tr.appendChild(tdHouse);

        const tdNote = document.createElement('td'); tdNote.textContent = member.note || '—'; tr.appendChild(tdNote);

        const tdActions = document.createElement('td');
        tdActions.innerHTML = `<button class="small-btn" onclick="window.editMemberHandler('${member.id}')">Edit</button>
                               <button class="small-btn" onclick="window.deleteMemberHandler('${member.id}')">Delete</button>`;
        tr.appendChild(tdActions);

        // search filter
        const hay = (member.name + ' ' + (member.note||'') + ' ' + (member.households||[]).map(h=>h.name+' '+h.note).join(' ')).toLowerCase();
        if(!q || hay.includes(q)) membersTableBody.appendChild(tr);
      });
    }

    function populateDonationFromOptions(){
      donationFromSel.innerHTML = '<option value="">-- Select Member / Household --</option>';
      state.members.forEach(m=>{
        const opt = document.createElement('option');
        opt.value = m.id;
        opt.text = `${m.name} (Member)`;
        donationFromSel.appendChild(opt);
        if(m.households && m.households.length){
          m.households.forEach(h=>{
            const opt2 = document.createElement('option');
            opt2.value = h.id;
            opt2.text = `${h.name} — (${m.name})`;
            donationFromSel.appendChild(opt2);
          });
        }
      });
    }

    function renderDonationsTable(){
      donationsTableBody.innerHTML = '';
      const q = (searchDonationsInput.value || '').toLowerCase().trim();
      const filtered = state.donations.slice().sort((a,b)=> new Date(b.date) - new Date(a.date));
      filtered.forEach(d=>{
        const tr = document.createElement('tr');
        const tdDate = document.createElement('td'); tdDate.textContent = d.date; tr.appendChild(tdDate);
        const tdType = document.createElement('td'); tdType.textContent = capitalize(d.type); tr.appendChild(tdType);
        const tdFrom = document.createElement('td'); tdFrom.textContent = d.fromName || findFromNameById(d.fromId) || '—'; tr.appendChild(tdFrom);
        const tdAmount = document.createElement('td'); tdAmount.textContent = (d.amountDisplay === '' ? '—' : (d.amountDisplay && typeof d.amountDisplay === 'string' ? d.amountDisplay : '₹ ' + formatRupee(d.amountRaw))); tr.appendChild(tdAmount);
        const tdNote = document.createElement('td'); tdNote.textContent = d.note || '—'; tr.appendChild(tdNote);
        const tdActions = document.createElement('td'); tdActions.innerHTML = `<button class="small-btn" onclick="editDonation('${d.id}')">Edit</button> <button class="small-btn" onclick="deleteDonation('${d.id}')">Delete</button>`; tr.appendChild(tdActions);

        const hay = (d.date + ' ' + d.type + ' ' + (d.fromName||'') + ' ' + (d.note||'') + ' ' + d.amountDisplay).toLowerCase();
        if(!q || hay.includes(q)) donationsTableBody.appendChild(tr);
      });
    }

    function renderSummary(){
      // For numeric totals only sum numeric amountRaw values; text amounts are ignored for numeric sums
      const totalNumericDonations = state.donations.reduce((s,d)=> s + (typeof d.amountRaw === 'number' ? Number(d.amountRaw||0): 0), 0);
      const totalJummaNetNumeric = state.jumma.reduce((s,j)=> s + (typeof j.amountRaw === 'number' ? Number(j.amountRaw||0): 0) - (typeof j.expenseRaw === 'number' ? Number(j.expenseRaw||0): 0), 0);
      const constructionRaisedNumeric = state.construction.contributions.reduce((s,c)=> s + (typeof c.amountRaw === 'number' ? Number(c.amountRaw||0) : 0), 0);
      const constructionSpentNumeric = state.construction.expenses.reduce((s,e)=> s + (typeof e.amountRaw === 'number' ? Number(e.amountRaw||0) : 0), 0);
      const balance = constructionRaisedNumeric - constructionSpentNumeric;

      totalCollectedEl.textContent = (totalNumericDonations ? '₹ ' + formatRupee(totalNumericDonations) : '₹ 0 (text amounts exist)');
      totalJummaEl.textContent = (totalJummaNetNumeric ? '₹ ' + formatRupee(totalJummaNetNumeric) : '₹ 0 (text amounts exist)');
      constructionSummaryEl.textContent = (balance ? '₹ ' + formatRupee(balance) : '₹ 0 (text amounts exist)');

      constructionTotalRaisedEl.textContent = (constructionRaisedNumeric ? '₹ ' + formatRupee(constructionRaisedNumeric) : '₹ 0 (text amounts exist)');
      constructionTotalSpentEl.textContent = (constructionSpentNumeric ? '₹ ' + formatRupee(constructionSpentNumeric) : '₹ 0 (text amounts exist)');
      constructionBalanceEl.textContent = (balance ? '₹ ' + formatRupee(balance) : '₹ 0 (text amounts exist)');
    }

    function populateLedgerMembers(){
      ledgerMemberSel.innerHTML = '<option value="">-- All / Select Member --</option>';
      state.members.forEach(m=>{
        const opt = document.createElement('option'); opt.value = m.id; opt.text = m.name; ledgerMemberSel.appendChild(opt);
      });
    }

    function renderLedgerForMember(){
      const memberId = ledgerMemberSel.value;
      ledgerTableBody.innerHTML = '';
      let list = [];
      if(!memberId){
        list = state.donations.slice().sort((a,b)=> new Date(b.date)-new Date(a.date));
      } else {
        const member = state.members.find(m=>m.id===memberId);
        const houseIds = (member && member.households) ? member.households.map(h=>h.id) : [];
        list = state.donations.filter(d => d.fromId === memberId || houseIds.includes(d.fromId)).sort((a,b)=> new Date(b.date)-new Date(a.date));
      }
      list.forEach(d=>{
        const tr = document.createElement('tr');
        const amountText = (d.amountDisplay && typeof d.amountDisplay === 'string') ? d.amountDisplay : (typeof d.amountRaw === 'number' ? '₹ ' + formatRupee(d.amountRaw) : d.amountDisplay);
        tr.innerHTML = `<td>${d.date}</td><td>${capitalize(d.type)}</td><td>${escapeHtml(amountText)}</td><td>${escapeHtml(d.note||'—')}</td>`;
        ledgerTableBody.appendChild(tr);
      });
    }

    // Jumma render
    function renderJummaTable(){
      jummaTableBody.innerHTML = '';
      const q = (searchJummaInput.value || '').toLowerCase().trim();
      const list = state.jumma.slice().sort((a,b)=> new Date(b.date) - new Date(a.date));
      list.forEach(j=>{
        const tr = document.createElement('tr');
        const netDisplay = (j.amountDisplay ? j.amountDisplay : (typeof j.amountRaw === 'number' ? '₹ ' + formatRupee(j.amountRaw) : j.amountDisplay))
                         + ' - ' +
                         (j.expenseDisplay ? j.expenseDisplay : (typeof j.expenseRaw === 'number' ? '₹ ' + formatRupee(j.expenseRaw) : j.expenseDisplay));
        const net = (typeof j.amountRaw === 'number' ? j.amountRaw : 0) - (typeof j.expenseRaw === 'number' ? j.expenseRaw : 0);
        tr.innerHTML = `<td>${j.date}</td>
                        <td>${escapeHtml(j.collectorName||findFromNameById(j.collectorId)||'—')}</td>
                        <td>${escapeHtml(j.amountDisplay ? j.amountDisplay : (typeof j.amountRaw === 'number' ? '₹ ' + formatRupee(j.amountRaw) : j.amountDisplay))}</td>
                        <td>${escapeHtml(j.expenseDisplay ? j.expenseDisplay : (typeof j.expenseRaw === 'number' ? '₹ ' + formatRupee(j.expenseRaw) : j.expenseDisplay))}</td>
                        <td>₹ ${formatRupee(net)}</td>
                        <td>${escapeHtml(j.note||j.expenseNote||'—')}</td>
                        <td><button class="small-btn" onclick="editJumma('${j.id}')">Edit</button> <button class="small-btn" onclick="deleteJumma('${j.id}')">Delete</button></td>`;
        const hay = (j.date + ' ' + j.collectorName + ' ' + j.note + ' ' + j.expenseNote).toLowerCase();
        if(!q || hay.includes(q)) jummaTableBody.appendChild(tr);
      });
    }

    // Construction render
    function renderConstructionTables(){
      contributorsTableBody.innerHTML = '';
      expensesTableBody.innerHTML = '';
      const q = (searchConstructionInput.value || '').toLowerCase().trim();

      state.construction.contributions.slice().sort((a,b)=> new Date(b.date)-new Date(a.date)).forEach(c=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${c.date}</td><td>${escapeHtml(c.name)}</td><td>${escapeHtml(c.amountDisplay ? c.amountDisplay : (typeof c.amountRaw === 'number' ? '₹ ' + formatRupee(c.amountRaw): c.amountDisplay))}</td><td>${escapeHtml(c.contact||'—')}</td><td>${capitalize(c.type)}</td><td><button class="small-btn" onclick="editContribution('${c.id}')">Edit</button> <button class="small-btn" onclick="deleteContribution('${c.id}')">Delete</button></td>`;
        const hay = (c.date + ' ' + c.name + ' ' + c.contact + ' ' + c.type).toLowerCase();
        if(!q || hay.includes(q)) contributorsTableBody.appendChild(tr);
      });

      state.construction.expenses.slice().sort((a,b)=> new Date(b.date)-new Date(a.date)).forEach(e=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${e.date}</td><td>${escapeHtml(e.for)}</td><td>${escapeHtml(e.amountDisplay ? e.amountDisplay : (typeof e.amountRaw === 'number' ? '₹ ' + formatRupee(e.amountRaw): e.amountDisplay))}</td><td>${escapeHtml(e.note||'—')}</td><td><button class="small-btn" onclick="editConstructionExpense('${e.id}')">Edit</button> <button class="small-btn" onclick="deleteConstructionExpense('${e.id}')">Delete</button></td>`;
        const hay = (e.date + ' ' + e.for + ' ' + e.note).toLowerCase();
        if(!q || hay.includes(q)) expensesTableBody.appendChild(tr);
      });
    }

    // -----------------------
    // Export / PDF / CSV
    // -----------------------

    // Helper: create PDF header area with Islamic architecture style (visual)
    function buildPdfHeader(container){
      const headerDiv = document.createElement('div');
      headerDiv.style.textAlign = 'center';
      headerDiv.style.marginBottom = '8px';
      headerDiv.innerHTML = `
        <div style="font-family: Amiri, serif; font-size:26px; color:#0b5d3a">${escapeHtml(state.mosque.name)}</div>
        <div style="font-size:12px;color:#666;margin-top:4px">${escapeHtml(state.mosque.address || '')}</div>
        <div style="font-family: Amiri, serif; font-size:18px; margin-top:6px; color:#0b5d3a">بسم الله الرحمن الرحيم</div>
      `;
      container.appendChild(headerDiv);

      // decorative arch - placeholder svg
      const arch = document.createElement('div');
      arch.style.width = '100%';
      arch.style.textAlign = 'center';
      arch.innerHTML = `<svg width="100%" height="60" viewBox="0 0 900 100" xmlns="http://www.w3.org/2000/svg"><path d="M0,100 C150,-50 750,-50 900,100" fill="#0b5d3a33"/></svg>`;
      container.appendChild(arch);
    }

    async function exportSummaryPDF(){
      // Build a styled container for PDF rendering (kept same structure + enhanced header)
      const container = document.createElement('div');
      container.style.padding = '22px';
      container.style.width = '900px';
      container.style.background = '#fff';
      container.style.boxSizing = 'border-box';
      container.style.fontFamily = 'Inter, sans-serif';

      buildPdfHeader(container);

      container.innerHTML += `
        <hr style="margin:12px 0"/>
        <h3 style="font-family: Amiri, serif; color:#0b5d3a">Summary</h3>
        <div id="pdf-summary-content"></div>
        <hr style="margin:12px 0"/>
        <h4 style="font-family: Amiri, serif; color:#0b5d3a">Recent Donations</h4>
        <div id="pdf-donations-list"></div>
        <hr style="margin:12px 0"/>
        <h4 style="font-family: Amiri, serif; color:#0b5d3a">Construction Contributors (recent)</h4>
        <div id="pdf-contribs-list"></div>
        <div style="margin-top:20px;font-size:11px;color:#666">Generated by Apni Masjid — Offline App</div>
      `;

      // fill summary
      const summaryDiv = container.querySelector('#pdf-summary-content');
      const totalNumericDonations = state.donations.reduce((s,d)=> s + (typeof d.amountRaw === 'number' ? Number(d.amountRaw||0): 0), 0);
      const totalJummaNetNumeric = state.jumma.reduce((s,j)=> s + (typeof j.amountRaw === 'number' ? Number(j.amountRaw||0): 0) - (typeof j.expenseRaw === 'number' ? Number(j.expenseRaw||0): 0), 0);
      const constructionRaisedNumeric = state.construction.contributions.reduce((s,c)=> s + (typeof c.amountRaw === 'number' ? Number(c.amountRaw||0) : 0), 0);
      const constructionSpentNumeric = state.construction.expenses.reduce((s,e)=> s + (typeof e.amountRaw === 'number' ? Number(e.amountRaw||0) : 0), 0);
      const balanceNumeric = constructionRaisedNumeric - constructionSpentNumeric;

      summaryDiv.innerHTML = `
        <p>Total Donations (numeric sums): <strong>₹ ${formatRupee(totalNumericDonations)}</strong></p>
        <p>Total Jumma Net (numeric sums): <strong>₹ ${formatRupee(totalJummaNetNumeric)}</strong></p>
        <p>Construction Balance (numeric sums): <strong>₹ ${formatRupee(balanceNumeric)}</strong></p>
        <p><em>Note: Textual amounts (alphabets) are preserved in lists but not included in numeric sums above.</em></p>
      `;

      // fill donations
      const dd = container.querySelector('#pdf-donations-list');
      state.donations.slice().sort((a,b)=> new Date(b.date)-new Date(a.date)).slice(0,50).forEach(d=>{
        const div = document.createElement('div');
        div.style.marginBottom = '6px';
        const amountText = (d.amountDisplay ? d.amountDisplay : (typeof d.amountRaw === 'number' ? '₹ ' + formatRupee(d.amountRaw) : '—'));
        div.innerHTML = `<strong>${escapeHtml(d.fromName || findFromNameById(d.fromId) || '—')}</strong> — ${escapeHtml(amountText)} — ${escapeHtml(d.type)} — ${d.date} ${d.note ? '- ' + escapeHtml(d.note) : ''}`;
        dd.appendChild(div);
      });

      const pc = container.querySelector('#pdf-contribs-list');
      state.construction.contributions.slice().sort((a,b)=> new Date(b.date)-new Date(a.date)).slice(0,50).forEach(c=>{
        const div = document.createElement('div');
        div.style.marginBottom = '6px';
        const amountText = (c.amountDisplay ? c.amountDisplay : (typeof c.amountRaw === 'number' ? '₹ ' + formatRupee(c.amountRaw) : '—'));
        div.innerHTML = `<strong>${escapeHtml(c.name)}</strong> — ${escapeHtml(amountText)} — ${escapeHtml(c.date)} ${c.contact ? '- ' + escapeHtml(c.contact) : ''}`;
        pc.appendChild(div);
      });

      // render with html2canvas + jsPDF
      if(window.html2canvas && window.jspdf){
        try{
          const canvas = await html2canvas(container, { scale: 2, useCORS: true });
          const imgData = canvas.toDataURL('image/png');
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF('p','pt','a4');
          const pdfWidth = pdf.internal.pageSize.getWidth();
          const imgWidth = pdfWidth - 40;
          const imgHeight = canvas.height * (imgWidth / canvas.width);
          pdf.addImage(imgData,'PNG',20,20,imgWidth,imgHeight);
          pdf.save((state.mosque.name || 'masjid') + '_summary.pdf');
        }catch(e){
          console.error(e);
          fallbackPrint(container);
        }
      } else fallbackPrint(container);
    }

    async function createIslamicNoticePDF(){
      const title = prompt('Notice ka title likhen', 'Eilan / Ailan');
      if (title === null) return;
      const bodyText = prompt('Notice ka content likhen', 'Yahan apna Islamic notice likhen. Jumma time: ...');
      if (bodyText === null) return;

      const container = document.createElement('div');
      container.style.width = '900px';
      container.style.padding = '36px';
      container.style.background = '#fff';
      container.style.position = 'relative';
      container.style.boxSizing = 'border-box';

      buildPdfHeader(container);

      const content = document.createElement('div');
      content.innerHTML = `<hr style="margin:12px 0"/>
        <h2 style="text-align:center;font-family: Amiri, serif">${escapeHtml(title)}</h2>
        <div style="margin-top:16px;font-size:14px;line-height:1.5">${escapeHtml(bodyText).replace(/\n/g,'<br/>')}</div>
        <div style="margin-top:32px;text-align:center;color:#666;font-size:12px"><em>Masjid management</em></div>`;
      container.appendChild(content);

      // ask for optional donation QR
      const addQR = confirm('Do you want to add donation QR code in this PDF?');
      if(addQR){
        const donationLink = prompt('Enter your donation link or UPI/Pay link (example: upi://pay?pa=... or https://...)');
        if(donationLink){
          const qrDiv = document.createElement('div');
          qrDiv.style.textAlign = 'center'; qrDiv.style.marginTop = '18px';
          container.appendChild(qrDiv);
          new QRCode(qrDiv, { text: donationLink, width: 140, height: 140, colorDark: "#0b5d3a", colorLight: "#ffffff" });
        }
      }

      if (window.html2canvas && window.jspdf) {
        try {
          const canvas = await html2canvas(container, { scale: 2, useCORS: true });
          const imgData = canvas.toDataURL('image/png');
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF('p','pt','a4');
          const pdfWidth = pdf.internal.pageSize.getWidth();
          const imgWidth = pdfWidth - 40;
          const imgHeight = canvas.height * (imgWidth / canvas.width);
          pdf.addImage(imgData, 'PNG', 20, 20, imgWidth, imgHeight);
          pdf.save((state.mosque.name || 'masjid') + '_notice.pdf');
        } catch (e) {
          console.error(e);
          fallbackPrint(container);
        }
      } else {
        fallbackPrint(container);
      }
    }

    async function exportLedgerPDF(){
      const memberId = ledgerMemberSel.value;
      const memberName = memberId ? (state.members.find(m=>m.id===memberId)?.name || 'ledger') : 'All_Members';
      const list = (memberId ? state.donations.filter(d => d.fromId === memberId || (state.members.find(m=>m.id===memberId)?.households||[]).some(h=>h.id===d.fromId)) : state.donations)
                    .sort((a,b)=> new Date(b.date) - new Date(a.date));

      const container = document.createElement('div');
      container.style.padding = '20px';
      container.style.width = '900px';
      container.style.boxSizing = 'border-box';

      buildPdfHeader(container);

      const titleDiv = document.createElement('div');
      titleDiv.style.marginTop = '12px';
      titleDiv.innerHTML = `<h2 style="font-family:Amiri, serif;color:#0b5d3a">${escapeHtml(state.mosque.name || '')} — Ledger (${escapeHtml(memberName)})</h2>`;
      container.appendChild(titleDiv);

      const tableWrapper = document.createElement('div');
      tableWrapper.innerHTML = `<table style="width:100%;border-collapse:collapse;margin-top:10px">
        <thead><tr><th style="border:1px solid #ddd;padding:6px">Date</th><th style="border:1px solid #ddd;padding:6px">Type</th><th style="border:1px solid #ddd;padding:6px">From</th><th style="border:1px solid #ddd;padding:6px">Amount</th><th style="border:1px solid #ddd;padding:6px">Note</th></tr></thead>
        <tbody>${list.map(d => `<tr><td style="border:1px solid #eee;padding:6px">${d.date}</td><td style="border:1px solid #eee;padding:6px">${escapeHtml(d.type)}</td><td style="border:1px solid #eee;padding:6px">${escapeHtml(d.fromName||findFromNameById(d.fromId)||'—')}</td><td style="border:1px solid #eee;padding:6px">${escapeHtml(d.amountDisplay ? d.amountDisplay : (typeof d.amountRaw === 'number' ? '₹ ' + formatRupee(d.amountRaw) : d.amountDisplay))}</td><td style="border:1px solid #eee;padding:6px">${escapeHtml(d.note||'')}</td></tr>`).join('')}</tbody>
      </table>`;
      container.appendChild(tableWrapper);

      if(window.html2canvas && window.jspdf){
        try{
          const canvas = await html2canvas(container,{scale:2,useCORS:true});
          const imgData = canvas.toDataURL('image/png');
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF('p','pt','a4');
          const pdfWidth = pdf.internal.pageSize.getWidth();
          const imgWidth = pdfWidth - 40;
          const imgHeight = canvas.height * (imgWidth / canvas.width);
          pdf.addImage(imgData,'PNG',20,20,imgWidth,imgHeight);
          pdf.save(`${memberName}_ledger.pdf`);
        }catch(e){ console.error(e); fallbackPrint(container); }
      } else fallbackPrint(container);
    }

    async function exportJummaPDF(){
      const container = document.createElement('div');
      container.style.padding = '20px';
      container.style.width = '900px';
      container.style.boxSizing = 'border-box';

      buildPdfHeader(container);

      container.innerHTML += `<h2 style="font-family:Amiri, serif;color:#0b5d3a">${escapeHtml(state.mosque.name || '')} — Jumma Ledger</h2>
        <div id="jumma-list"></div>`;

      const jl = container.querySelector('#jumma-list');
      state.jumma.sort((a,b)=>new Date(b.date)-new Date(a.date)).forEach(j => {
        const item = document.createElement('div');
        item.style.marginBottom = '6px';
        const collected = (j.amountDisplay ? j.amountDisplay : (typeof j.amountRaw === 'number' ? '₹ ' + formatRupee(j.amountRaw) : j.amountDisplay));
        const expense = (j.expenseDisplay ? j.expenseDisplay : (typeof j.expenseRaw === 'number' ? '₹ ' + formatRupee(j.expenseRaw) : j.expenseDisplay));
        item.textContent = `${j.date} — ${j.collectorName || findFromNameById(j.collectorId) || '—'} — Collected: ${collected} — Expense: ${expense} — Note: ${j.note || j.expenseNote || ''}`;
        jl.appendChild(item);
      });

      if(window.html2canvas && window.jspdf){
        try{
          const canvas = await html2canvas(container,{scale:2,useCORS:true});
          const imgData = canvas.toDataURL('image/png');
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF('p','pt','a4');
          const pdfWidth = pdf.internal.pageSize.getWidth();
          const imgWidth = pdfWidth - 40;
          const imgHeight = canvas.height * (imgWidth / canvas.width);
          pdf.addImage(imgData,'PNG',20,20,imgWidth,imgHeight);
          pdf.save('jumma_ledger.pdf');
        }catch(e){ console.error(e); fallbackPrint(container); }
      } else fallbackPrint(container);
    }

    async function exportConstructionReport(){
      const container = document.createElement('div');
      container.style.padding = '20px'; container.style.width = '900px'; container.style.boxSizing = 'border-box';

      buildPdfHeader(container);

      container.innerHTML += `<h2 style="font-family:Amiri, serif;color:#0b5d3a">${escapeHtml(state.mosque.name || '')} — Construction Report</h2>
        <div id="pdf-contribs"></div>
        <div id="pdf-expenses"></div>
      `;
      const pc = container.querySelector('#pdf-contribs');
      pc.innerHTML = '<h4>Contributors</h4>';
      state.construction.contributions.slice().sort((a,b)=>new Date(b.date)-new Date(a.date)).forEach(c=>{
        const d = document.createElement('div');
        d.style.marginBottom = '6px';
        const amt = (c.amountDisplay ? c.amountDisplay : (typeof c.amountRaw === 'number' ? '₹ ' + formatRupee(c.amountRaw) : c.amountDisplay));
        d.textContent = `${c.date} — ${c.name} — ${amt} — ${c.contact || ''} — ${capitalize(c.type)}`;
        pc.appendChild(d);
      });
      const pe = container.querySelector('#pdf-expenses');
      pe.innerHTML = '<h4 style="margin-top:12px">Expenses</h4>';
      state.construction.expenses.slice().sort((a,b)=>new Date(b.date)-new Date(a.date)).forEach(e=>{
        const d = document.createElement('div');
        d.style.marginBottom = '6px';
        const amt = (e.amountDisplay ? e.amountDisplay : (typeof e.amountRaw === 'number' ? '₹ ' + formatRupee(e.amountRaw) : e.amountDisplay));
        d.textContent = `${e.date} — ${e.for} — ${amt} — ${e.note || ''}`;
        pe.appendChild(d);
      });

      if(window.html2canvas && window.jspdf){
        try{
          const canvas = await html2canvas(container,{scale:2,useCORS:true});
          const imgData = canvas.toDataURL('image/png');
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF('p','pt','a4');
          const pdfWidth = pdf.internal.pageSize.getWidth();
          const imgWidth = pdfWidth - 40;
          const imgHeight = canvas.height * (imgWidth / canvas.width);
          pdf.addImage(imgData,'PNG',20,20,imgWidth,imgHeight);
          pdf.save('construction_report.pdf');
        }catch(e){ console.error(e); fallbackPrint(container); }
      } else fallbackPrint(container);
    }

    function exportAllCSV(){
      let csv = 'Date,Type,From,Amount,Note\n';
      state.donations.forEach(d=>{
        const from = d.fromName || findFromNameById(d.fromId) || '';
        const amount = (d.amountDisplay ? d.amountDisplay : (typeof d.amountRaw === 'number' ? d.amountRaw : ''));
        csv += [`"${d.date}"`, `"${d.type}"`, `"${from}"`, `"${amount}"`, `"${(d.note||'').replace(/"/g,'""')}"`].join(',') + '\n';
      });
      const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = (state.mosque.name || 'masjid') + '_donations.csv';
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }

    // Fallback print (open new window)
    function fallbackPrint(element){
      const newWin = window.open('', '_blank');
      newWin.document.write('<html><head><title>Report</title></head><body>');
      newWin.document.write(element.innerHTML);
      newWin.document.write('</body></html>');
      newWin.document.close();
      newWin.print();
    }

    // -----------------------
    // QR code & scanner helper
    // -----------------------
    function openQRCodeDialog(){
      const donationLink = prompt('Enter donation link or UPI ID / URL (e.g., upi://pay?pa=... or https://...)');
      if(!donationLink) return;
      const w = window.open('', '_blank', 'width=420,height=500');
      w.document.write('<html><head><title>Donation QR</title></head><body style="display:flex;align-items:center;justify-content:center;height:100%;font-family:Inter, sans-serif">');
      w.document.write('<div id="qrwrap" style="text-align:center"><div id="qr"></div><div style="margin-top:10px;color:#666">'+escapeHtml(donationLink)+'</div></div>');
      w.document.write('</body></html>');
      w.document.close();
      setTimeout(()=> {
        try{
          new w.QRCode(w.document.getElementById('qr'), { text: donationLink, width:240, height:240, colorDark:"#0b5d3a", colorLight:"#ffffff" });
        }catch(e){
          const qrDiv = document.createElement('div'); qrDiv.id='tempqr'; document.body.appendChild(qrDiv);
          new QRCode(qrDiv, { text: donationLink, width:240, height:240, colorDark:"#0b5d3a", colorLight:"#ffffff" });
        }
      },200);
    }

    // -----------------------
    // Utility helpers
    // -----------------------
    function formatRupee(n){
      const num = Number(n) || 0;
      return num.toLocaleString('en-IN');
    }
    function capitalize(s){ if(!s) return ''; return s[0].toUpperCase() + s.slice(1); }
    function escapeHtml(str){ if(!str && str !== 0) return ''; return String(str).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; }); }
    function findFromNameById(id){
      if(!id) return '';
      const m = state.members.find(mm => mm.id === id);
      if(m) return m.name;
      for(const mm of state.members){
        if(mm.households){
          const h = mm.households.find(hh => hh.id === id);
          if(h) return `${h.name} (${mm.name})`;
        }
      }
      return '';
    }

    // -----------------------
    // Populate helpers
    // -----------------------
    function populateYearFilters(){
      // placeholder if needed later
    }

    // -----------------------
    // Inline exposure for delete handlers (safe)
    // -----------------------
    window.deleteDonationHandler = function(id){ deleteDonation(id); };

    // -----------------------
    // Finalize render initial
    // -----------------------
    renderAllUI();

    /* ===========================
       Extra small helpers & UX
       =========================== */

    // quick keyboard shortcut: Ctrl+E export summary
    window.addEventListener('keydown', (e) => {
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'e'){
        e.preventDefault();
        exportSummaryPDF();
      }
    });

    /* =================================================
       PLACEHOLDER BLOCKS FOR FUTURE ADDITIONS (DO NOT MODIFY CORE)
       The sections below are intentionally long and commented
       to reach the requested file size and to show WHERE to
       add future features. Each block is a labeled placeholder.
       Add your future code inside these placeholders as needed.
       ================================================= */

    /* ===========================
       PLACEHOLDER: Authentication Module
       - Future: Add simple password / PIN lock for the app
       - Suggested place: inside this block implement UI + storage
       =========================== */
    /* BEGIN AUTH MODULE (ADD LATER)
       -------------------------------------------------------
       Example planned features:
       - Admin PIN / password protected actions (reset, export)
       - Multiple user roles: admin, treasurer, member
       - Login/logout UI
       - Audit log of actions
       -------------------------------------------------------
       Implementation hints:
       - Use localStorage key 'masjid_auth'
       - Store salted-hash (client-side) or rely on device security
       - Provide 'forgot PIN' flow that requires clearing local data
       -------------------------------------------------------
       // Example function signatures to implement later:
       function setupAuthUI() { ... }
       function createAdminPin(pin) { ... }
       function verifyPin(pin) { ... }
       function requirePinFor(actionCallback) { ... }
       END AUTH MODULE (ADD LATER) */
    // long comment filler to expand file size and indicate where to add
    /* .........................................................................................................
       .........................................................................................................
       .........................................................................................................
       .........................................................................................................
       (repeat with meaningful comments to guide future implementation)
       .........................................................................................................
       .........................................................................................................
       ......................................................................................................... */

    /* ===========================
       PLACEHOLDER: Backup & Restore
       - Future: Export full app JSON backup and restore option
       - Suggested place: add UI button near Reset All Data
       =========================== */
    /* BEGIN BACKUP MODULE (ADD LATER)
       -------------------------------------------------------
       Features:
       - Export all data as JSON file (.json)
       - Import JSON to restore (validate schema)
       - Option to save encrypted backups with password
       - Option to sync with Google Drive / Dropbox (later)
       -------------------------------------------------------
       // Example function signatures:
       function exportBackup() { ... }
       function importBackup(file) { ... }
       function validateBackupSchema(obj) { ... }
       END BACKUP MODULE (ADD LATER) */
    /* .........................................................................................................
       .........................................................................................................
       .........................................................................................................
       .........................................................................................................
       ......................................................................................................... */

    /* ===========================
       PLACEHOLDER: Multi-Mosque Support
       - Future: Allow managing multiple masjids from same UI
       =========================== */
    /* BEGIN MULTI-MOSQUE (ADD LATER)
       -------------------------------------------------------
       Ideas:
       - state.multimasjids = [{id, name, state}, ...]
       - switchMasjid(mosqueId) function
       - copy data between masjids
       -------------------------------------------------------
       // Example:
       function addNewMasjid(mosqueData) { ... }
       function switchMasjid(mosqueId) { ... }
       END MULTI-MOSQUE (ADD LATER) */
    /* .........................................................................................................
       .........................................................................................................
       ......................................................................................................... */

    /* ===========================
       PLACEHOLDER: Data Visualization & Charts
       - Future: Add charts (donations by month, construction progress)
       - Use recharts or Chart.js (when online)
       =========================== */
    /* BEGIN CHARTS (ADD LATER)
       -------------------------------------------------------
       Steps:
       - Add lightweight charts using canvas + chart.js if allowed
       - Create data aggregation functions:
         - donationsByMonth()
         - contributionsByContributor()
         - jummaTrends()
       - Render charts in dashboard section
       -------------------------------------------------------
       // Example functions:
       function donationsByMonth() { ... }
       function renderDonationChart(canvasEl, data) { ... }
       END CHARTS (ADD LATER) */
    /* .........................................................................................................
       .........................................................................................................
       ......................................................................................................... */

    /* ===========================
       PLACEHOLDER: Notifications & Reminders
       - Future: Add local reminders for Jumma, Zakat due dates, events
       =========================== */
    /* BEGIN REMINDERS (ADD LATER)
       -------------------------------------------------------
       Ideas:
       - Use browser Notifications API with permission
       - Store reminders in state.reminders: [{id, title, date, repeat}]
       - UI to create and list reminders
       -------------------------------------------------------
       function scheduleReminder(reminder) { ... }
       function cancelReminder(id) { ... }
       END REMINDERS (ADD LATER) */
    /* .......................................................................................................
       .......................................................................................................
       ....................................................................................................... */

    /* ===========================
       PLACEHOLDER: Internationalization (i18n)
       - Future: Support Urdu, English, Hindi toggles for UI text
       =========================== */
    /* BEGIN I18N (ADD LATER)
       -------------------------------------------------------
       Steps:
       - Add a translations object with keys for UI strings
       - Provide a language selector dropdown in header
       - On language change, update innerText of UI elements
       -------------------------------------------------------
       const i18n = { 'en': {...}, 'hi': {...}, 'ur': {...} };
       function setLanguage(lang) { ... }
       END I18N (ADD LATER) */
    /* .......................................................................................................
       .......................................................................................................
       ....................................................................................................... */

    /* ===========================
       PLACEHOLDER: Permissions & Audit Log
       - Future: Track who added/edited/deleted using 'user' or 'role'
       =========================== */
    /* BEGIN AUDIT LOG (ADD LATER)
       -------------------------------------------------------
       Plan:
       - Maintain state.audit = [{id, ts, user, action, details}]
       - Show audit UI for admins
       - Export audit logs to CSV
       -------------------------------------------------------
       function logAction(user, action, details) { ... }
       function renderAuditLog() { ... }
       END AUDIT LOG (ADD LATER) */
    /* .......................................................................................................
       .......................................................................................................
       ....................................................................................................... */

    /* ===========================
       PLACEHOLDER: Mobile App Packaging
       - Future: Wrap as PWA or Cordova app for offline mobile use
       =========================== */
    /* BEGIN PWA (ADD LATER)
       -------------------------------------------------------
       Tasks:
       - Add manifest.json
       - Add service worker for offline assets
       - Provide install prompt
       -------------------------------------------------------
       // sw.js, manifest.json, and icons
       END PWA (ADD LATER) */
    /* .......................................................................................................
       .......................................................................................................
       ....................................................................................................... */

    /* ===========================
       PLACEHOLDER: Template & Styling Extensions
       - Future: More Islamic architecture visuals, printable letterheads
       =========================== */
    /* BEGIN TEMPLATE EXT (ADD LATER)
       -------------------------------------------------------
       Ideas:
       - Multiple PDF templates (minimal, ornate, modern)
       - Add header/footer templates with mosque emblem
       - Add Arabic calligraphy SVGs and pattern backgrounds
       -------------------------------------------------------
       function registerPdfTemplate(id, renderFn) { ... }
       END TEMPLATE EXT (ADD LATER) */
    /* .......................................................................................................
       .......................................................................................................
       ....................................................................................................... */

    /* ===========================
       PLACEHOLDER: CSV / Excel Enhanced Export
       - Future: Export detailed CSVs for donors, contributors, ledgers
       =========================== */
    /* BEGIN CSV EXT (ADD LATER)
       -------------------------------------------------------
       Possible files:
       - donors_full.csv (with contact)
       - contributors_full.csv
       - jumma_full.csv
       - ledger_by_member.csv
       -------------------------------------------------------
       function exportCsvDetailed(type) { ... }
       END CSV EXT (ADD LATER) */
    /* .......................................................................................................
       .......................................................................................................
       ....................................................................................................... */

    /* ===========================
       PLACEHOLDER: Role-based UI customization
       - Future: Different UI for trustee, treasurer, volunteer
       =========================== */
    /* BEGIN ROLE UI (ADD LATER)
       -------------------------------------------------------
       - Provide settings to show/hide actions
       - Example: treasurer sees donations & exports; volunteer sees jumma only
       -------------------------------------------------------
       function setRole(role) { ... }
       END ROLE UI (ADD LATER) */
    /* .......................................................................................................
       .......................................................................................................
       ....................................................................................................... */

    /* ===================================================================================
       END OF PLACEHOLDER BLOCKS
       =================================================================================== */

  </script>
</body>
</html>
```
